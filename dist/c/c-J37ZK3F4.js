import{e as y,f as P,k as C}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-NNSEZ57I.js";import{a as p,b as E}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-KQYAPB5L.js";import{a as l,f as g}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-ZYG7ZY5I.js";var f=l(()=>{"use strict"});var T,O,A,w,q,S,_=l(()=>{"use strict";E();T=(s,e)=>p.post(`/api/ecommerce/${s}/stripe/checkout-session`,{...e}),O=(s,e)=>p.get(`/api/ecommerce/${s}/stripe/customer/by-checkout-session/${e}`),A=(s,e)=>p.post(`/api/ecommerce/${s}/stripe/billing-portal-session`,{...e}),w=(s,e)=>p.get(`/api/connect/ecommerce/${e}/disconnect?num_id=${s}`),q=(s,e)=>p.get(`/api/${e?"published_projects":"projects"}/${s}/ecommerce/stripe/products`),S=(s,e)=>p.get(`/api/ecommerce/${s}/ecwid/products${e}`)});var h,b,v=l(()=>{"use strict";f();_();C();h=["SELECT","SIZE","RADIO"],b=class{constructor(e){g(this,"numId");g(this,"libraryAdded",!1);this.numId=e}async disconnect(e){return await w(e,"ecwid")}async loadProducts(e,r,t){let c=t&&window?.RM?.screenshotMode==="preview"?"?type=preview":r?"?type=published":"";return(await S(e,c)).data||[]}mapProductsToSelectOptions(e,r){let t=e.map(c=>({value:c.id,caption:c.name}));return r&&r!=="default"&&!t.find(c=>c.value===r)&&t.unshift({value:r,caption:"inactive product"}),t.unshift({value:"default",caption:"None"}),t}isProductActive(e){return!!e.active}productHasActiveOptions(e){return!!e.options?.some(r=>h.includes(r.type))}productHasActivePrice(e){return Array.isArray(e.prices)&&!!e.prices?.some(r=>r.active)}isProductAvailable(e){if(e.inStock){let r=e.selectedCombination||e;if(typeof r.quantity>"u"||r.quantity)return!0}return!1}getProductForAddToCart(e,r){let t={...e};if(t&&r&&(t.selectedOptions={...r},Array.isArray(t.combinations))){let c=t.combinations.find(n=>n.options.every(o=>r[o.name]===o.value));c&&(t.selectedCombination={...c})}return t}initFrontendLibrary(e){if(!this.libraryAdded&&e?.ecwid?.serviceData){let r=document.createElement("script"),t=`https://app.ecwid.com/script.js?${e.ecwid.serviceData.storeId}&data_platform=code`;r.setAttribute("async","async"),r.setAttribute("charset","utf-8"),r.setAttribute("src",t),document?.body?.appendChild(r),this.libraryAdded=!0}}getFormattedProductToAddToCart(e,r){let t={...e},c=P(),n={id:t.id.toString(),name:t.name,nameTranslated:t.nameTranslated[c]||t.name,image:t.images?.[0],price:t.price,currency:t.currency};if(typeof t.quantity=="number"&&(n.quantity=t.quantity),r&&Object.keys(r).length){n.options={...r};let o=t.price;if(Array.isArray(t.combinations)){let a=t.combinations.find(u=>u.options.every(i=>r[i.name]===i.value));a&&(a.price&&(o=a.price),a.thumbnailUrl&&(n.image=a.thumbnailUrl),typeof a.quantity=="number"?n.quantity=a.quantity:n.quantity&&delete n.quantity)}if(t.options){for(let a in r){let u=t.options.find(d=>d.name===a),i=u?u.choices?.find(d=>d.text===r[a]):null;i&&i.priceModifier&&(i.priceModifierType==="ABSOLUTE"?o+=i.priceModifier:i.priceModifierType==="PERCENT"&&(o+=o*Number((i.priceModifier/100).toFixed(2))))}n.optionsTranslated=Object.fromEntries(Object.entries(n.options).map(([a,u])=>{let i=t.options?.find(m=>m.name===a);if(!i)return[a,u];let d=y(i);return[d.translatedName,d.translatedValues[u]]}))}o&&o!==n.price&&(n.price=o)}return n}waitEcwidPopupClose(e){let t=".ecwid-popup",c=setInterval(()=>{document.querySelector(t)||(clearInterval(c),e())},500)}async goToCheckout({items:e,callbacks:r}){let{onOpen:t,onPlaced:c,onClose:n}=r||{},o=window?.Ecwid;if(!o){console.error("No ecwid global library");return}o.init(),await new Promise(i=>o.Cart.clear(i)),await new Promise(i=>o.Cart.calculateTotal(i));let a=Object.keys(e).length,u=[];for(let i in e){let d={id:Number(e[i].id),quantity:e[i].cartQuantity,callback:m=>{m&&u.push(i),a===u.length&&(o.Cart.gotoCheckout(),t&&t(),n&&this.waitEcwidPopupClose(n),o.OnOrderPlaced.add(()=>{c&&c()}))}};e[i].options&&(d.options=e[i].options),o.Cart.addProduct(d)}}}});export{f as a,T as b,O as c,A as d,w as e,q as f,_ as g,h,b as i,v as j};
