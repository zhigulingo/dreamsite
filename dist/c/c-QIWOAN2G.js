import{C as fe,a as q,b as ge,n as ze,p as O,q as ue,r as me,s as Ge,t as v,u as _,v as D,x as he,y as Ue,z as V}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-KKFGT3PE.js";import{a as g,b as w}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-CIEIK2MX.js";import{b as de,c as Ce}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-KUXL4TRD.js";import{o as N,q as pe,w as Be}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-UHXDCVRZ.js";import{a as be,b as Ze}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-R2MDRFXN.js";import{a as y,b as ce}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-KTW64MJD.js";import{a as le,b as Fe}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-NJESKEPT.js";import{b as M,k as ee,o as te,q as ie,r as ke}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-CWQ7UVOU.js";import{e as Z,j as R,k as P,l as A}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-7U5B3NHZ.js";import{D as ne,E as T,i as re,j as oe,s as se}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-3Z7TN3F3.js";import{a as U}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-75DVMCH6.js";import{b as ae,c as He}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-R72ZIPE6.js";import{c as G}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-YKRSBDJJ.js";import{a as z,b as Le,c as S,d as J}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-4EBQPF62.js";import{a as f,d as F,f as o}from"https://st-p.rmcdn1.net/fb5a3d71/dist/c/c-ZYG7ZY5I.js";var Pe=f(()=>{"use strict"});var we,Se=f(()=>{"use strict";Pe();we=(u=21)=>crypto.getRandomValues(new Uint8Array(u)).reduce((d,e)=>(e&=63,e<36?d+=e.toString(36):e<62?d+=(e-26).toString(36).toUpperCase():e>62?d+="-":d+="_",d),"")});var x,Q=f(()=>{"use strict";Se();w();te();x=class extends g{constructor(e){super();o(this,"triggersState",{});o(this,"triggersElements",{});o(this,"stores",[this]);this.initStore(),e&&this.stores.push(e)}bindTriggerElement(e,t){this.setState(i=>({triggersElements:{...i.triggersElements,[e]:t}})),this.bindTriggerCallback(e)}bindTriggerCallback(e){let t=[];for(let i of this.stores){let r=i.triggersState[e]||{},s=i.triggersElements[e];if(s)for(let p in r){let a=r[p];a&&(typeof a.unbind=="function"&&a.unbind(),a.unbind=ee({element:s,events:a.events,callback:a.callback}),t.push(a.unbind))}}return t}addTriggerCallback({responderWidgetId:e,triggerWidgetIds:t=[],events:i,callback:r}){let s=we(),p=[];for(let a of this.stores)for(let l of t){let m=`${e}-${s}`;l in a.triggersState||a.setState(n=>({triggersState:{...n.triggersState,[l]:{}}})),a.setState(n=>({triggersState:{...n.triggersState,[l]:{...n.triggersState[l],[m]:{events:i,callback:r}}}}));let h=a.bindTriggerCallback(l)||[];p.push(()=>{for(let n of h)typeof n=="function"&&n();delete a.triggersState[l][m]})}return()=>{for(let a of p)a()}}isWidgetTrigger(e){return this.stores.some(t=>e in t.triggersState)}}});var W,K=f(()=>{"use strict";T();w();ze();ke();W=class extends g{constructor(e){super();o(this,"animations",{});o(this,"groupRects",{});o(this,"groupState",{});o(this,"readyToPlayLoadAnimations",!1);o(this,"initialized",!1);o(this,"widgetsState",{});o(this,"widgetsWithLoadAnimation",0);if(this.initStore(),e){let{widgetsState:t,widgetsWithLoadAnimation:i}=e.getWidgetsState();[this.widgetsState,this.widgetsWithLoadAnimation]=[t,i]}this.subscribe(t=>t.animations,()=>this.recalculateRectsStates())}init(e){if(this.initialized){console.error("AnimationsStore: init already called");return}if(e.length){for(let t of e){let i=t.hasLoadAnimation();this.widgetsState[t.model._id]={hasLoadAnimation:i},i&&!t.isHiddenInViewport()&&this.widgetsWithLoadAnimation++}this.initialized=!0}}getWidgetsState(){return{widgetsWithLoadAnimation:this.widgetsWithLoadAnimation,widgetsState:{...this.widgetsState}}}setWidgetLoad(e){this.widgetsState[e].hasLoadAnimation&&(this.widgetsWithLoadAnimation--,this.widgetsWithLoadAnimation===0&&this.setState({readyToPlayLoadAnimations:!0}))}getAnimationsGroups(e){let t={},i=re(Object.values(e).map(s=>s.animations).flat(),"UUID"),r=Object.entries(e);for(let[s,p]of r)for(let a of p.animations)i[a.UUID]>1&&(t[a.UUID]=[...t[a.UUID]||[],{widgetId:s,rect:p.rect}]);return t}getAnimationsGroupsRects(e){let t={},i=Object.keys(e);for(let r of i){let s=e[r].map(c=>{let b=this.animations[c.widgetId].transforms.rotation?.angle??0;return ie.rotateBox(c.rect,b)}),p=Math.min(...s.map(c=>c.top)),a=Math.min(...s.map(c=>c.left)),l=Math.max(...s.map(c=>c.top+c.height)),h=Math.max(...s.map(c=>c.left+c.width))-a,n=l-p;t[r]={top:p,left:a,width:h,height:n}}return t}createGroupsState(e,t){let i={...e};for(let r in t){i[r]=i[r]||{};for(let s of t[r])s.widgetId in i[r]||(i[r][s.widgetId]=!1)}return i}addWidget({widgetId:e,animations:t,rect:i,rotation:r,flipY:s,flipX:p}){this.setState(a=>({animations:{...a.animations,[e]:{rect:i,animations:t,transforms:{flipX:p,flipY:s,rotation:q(r),invertedRotation:q((r||0)*-1)}}}}))}recalculateRectsStates(){let e=this.getAnimationsGroups(this.animations),t=this.getAnimationsGroupsRects(e),i=this.createGroupsState(this.groupState,e);this.setState({groupRects:t,groupState:i})}updateWidgetRect(e,t){this.setState(i=>({animations:{...i.animations,[e]:{...i.animations[e],rect:t}}}))}getAnimationsGroupRect(e){return e in this.groupRects?this.groupRects[e]:null}getAnimationsGroupOrigin(e,t){if(e in this.groupRects&&t in this.animations){let i=this.animations[t],r=i.transforms,s=i.rect,p=this.groupRects[e],a={x:s.left-p.left,y:s.top-p.top},l={x:p.width/2,y:p.height/2},m={x:l.x-a.x,y:l.y-a.y},h=ge({rotation:r.invertedRotation,point:m,origin:{...s,left:0,top:0}});return r.flipX&&(h.x=s.width-h.x),r.flipY&&(h.y=s.height-h.y),h}return null}getGroupState(e){return e in this.groupState?Object.values(this.groupState[e]).some(Boolean):null}updateGroupState(e,t,i,r=!1){if(r){let s=this.groupState[e]?Object.keys(this.groupState[e]):[];s.includes(t)||s.push(t);let p=s.map(a=>[a,i]);this.setState(a=>({groupState:{...a.groupState,[e]:Object.fromEntries(p)}}))}else e in this.groupState?this.setState(s=>({groupState:{...s.groupState,[e]:{...s.groupState[e],[t]:i}}})):this.setState(s=>({groupState:{...s.groupState,[e]:{[t]:i}}}))}getAnimationsWidgetRect(e){return this.animations[e]?.rect||null}}});var j,Y=f(()=>{"use strict";w();j=class extends g{constructor(){super();o(this,"zIndexes",{});this.initStore()}init(e){for(let t of e)typeof t.model.z=="number"&&this.setZIndex(t.model._id,t.model.z)}getTopmostZIndex(){return Math.max(...Object.values(this.zIndexes))}setZIndex(e,t){typeof t=="number"&&this.zIndexes[e]!==t&&this.setState(i=>({zIndexes:{...i.zIndexes,[e]:t}}))}}});var Qe,E,ve=f(()=>{"use strict";w();A();J();D();D();Qe={pageId:"",scale:1,zoom:1,transform:1,num:0,availableViewports:[],currentViewport:"default",hasTabletViewport:!1,hasPhoneViewport:!1,screenshot:"",desktopPageHeight:0,tabletPageHeight:0,phonePageHeight:0,widgetsIds:[]},E=class extends g{constructor(e){super();o(this,"projectViewport");o(this,"page");o(this,"state",Qe);this.initStore(),this.page=e.page,this.setState({projectViewport:e.projectViewport.value}),e.projectViewport.subscribe(t=>t.value,t=>{this.setState({projectViewport:t}),this.computePageMeta()}),this.page.subscribe(t=>t.model,()=>{this.computePageMeta()}),this.computePageMeta()}computePageMeta(){let e=this.doesPageHasViewport("tablet_portrait"),t=this.doesPageHasViewport("phone_portrait"),i=["default",e&&"tablet_portrait",t&&"phone_portrait"].filter(Boolean);this.setState(r=>({state:{...r.state,pageId:this.page.model._id,num:this.page.model.num,uri:this.page.model.uri,seo:this.page.model.seo,customSeo:this.page.model.custom_shares,screenshot:this.page.model.screenshot,desktopPageHeight:_(this.page.model,"default"),tabletPageHeight:_(this.page.model,"tablet_portrait"),phonePageHeight:_(this.page.model,"phone_portrait"),currentViewport:this.getPageViewport(this.projectViewport),hasTabletViewport:e,hasPhoneViewport:t,availableViewports:i,widgetsIds:this.page.model.widgets?.map(s=>s._id)??[]}}))}onScaleChange(e){this.setState(t=>({state:{...t.state,scale:e,zoom:S.isFirefox()?1:e,transform:S.isFirefox()?e:1}}))}getClosestViewport(e){let t=P.dictionary[e].width,i=P.viewports.reduce((r,s,p)=>{let a=v(s.name);if(a!=="viewport_default"){let l=this.page.model[a];if(!l||!l.enabled)return r}return Math.abs(s.width-t)<=Math.abs(P.viewports[r].width-t)?p:r},0);return P.viewports[i].name}doesPageHasViewport(e){let t=v(e);return t==="viewport_default"?!this.page.model.hidden:t in this.page.model&&!!this.page.model[t]?.enabled}getPageViewport(e){return!e||e==="default"||this.doesPageHasViewport(e)?e:this.getClosestViewport(e)}}});function Ke(u){return pe(u)?u.code.length>0:!0}function $(u,d){let e=y(u),t=!!e.hidden;return R(e,(i,r)=>{i&&(d.includes(r)?i.hidden=ae.isModernMinimalViewport?i.hidden??t:!!i.hidden:i.hidden=!0)}),e}var ye,I,Gt,Ut,X=f(()=>{"use strict";ye=F(U());A();Q();K();Y();T();ce();w();fe();ve();ue();Be();te();Ge();D();He();I=class extends g{constructor(e){super();o(this,"project");o(this,"triggersStore");o(this,"animationsStore");o(this,"zIndexStore");o(this,"model");o(this,"meta");o(this,"element");o(this,"widgets");o(this,"visibility");o(this,"virtualOffset",0);this.initStore(),this.project=e.project,this.setState({triggersStore:new x(e?.triggersStore),animationsStore:new W(e?.animationsStore),zIndexStore:new j,element:new O,model:e.page}),this.setState({visibility:this.getInitialVisibility(),meta:new E({page:this,projectViewport:e.project.projectViewport})}),this.setState({widgets:this.createWidgets(this.model.widgets)});let t=Object.values(this.widgets).flat();this.animationsStore.init(t),this.zIndexStore.init(t),this.bindElementListener()}bindElementListener(){this.element.subscribe(e=>e.ref,e=>{e&&me.observe(e,this.visibility.isVisible,t=>{(0,ye.startTransition)(()=>{this.setState({visibility:t})})})})}getInitialVisibility(){return this.project.meta.initialPageId===this.model._id?{isVisible:!0,wasVisible:!0,aboutToShow:!0}:{isVisible:!1,wasVisible:!1,aboutToShow:!1}}createWidgets(e=[]){let t={topFixed:[],backFixed:[],regular:[]};if(!e.length)return t;let i=l=>({...l,pid:this.model._id}),r=y(this.project.model.globalWidgets||[]).map(i),s=y(e).map(i),p=ne([...s,...r],l=>l._id);this.meta.setState(l=>({state:{...l.state,widgetsIds:p.map(m=>m._id)}}));let a=this.getWidgetsRenderList(p);a.background&&(t.background=this.createWidget(a.background));for(let l of a.topFixed)t.topFixed.push(this.createWidget(l));for(let l of a.backFixed)t.backFixed.push(this.createWidget(l));for(let l of a.regular)t.regular.push(this.createWidget(l));return t}createWidget(e){return new V({pageMeta:this.meta,project:this.project,triggersStore:this.triggersStore,animationsStore:this.animationsStore,zIndexStore:this.zIndexStore,widget:e})}setWidgets(e){this.setState(i=>({model:{...i.model,widgets:e},widgets:this.createWidgets(e)}));let t=Object.values(this.widgets).flat();this.animationsStore.init(t),this.zIndexStore.init(t)}getWidgetsRenderList(e=[]){if(!e||!e.length)return{regular:[],topFixed:[],backFixed:[]};let t,i=[],r=[],s=[],p={},a={},l={},m=Z.reduce((n,c)=>(n[c]=1/0,n),{}),h=Z.filter(n=>this.isViewportEnabled(n));for(let n of e)if(Ke(n))if(N(n))t=n;else{if(n.is_above)continue;for(let c of h){let b=V.getWidgetViewportData(n,c,this.model._id);b&&(b.fixed_position||(p[n._id]=p[n._id]||{widget:n,viewports:[]},p[n._id].viewports.push(c),m[c]=Math.min(m[c],b.z)))}}for(let n of h)m[n]===1/0&&(m[n]=0);for(let n of e)if(!(N(n)||n.is_above))for(let c of h){let b=V.getWidgetViewportData(n,c,this.model._id);!b||!b.fixed_position||(b.z<m[c]?(l[n._id]=l[n._id]||{widget:n,viewports:[]},l[n._id].viewports.push(c)):(a[n._id]=a[n._id]||{widget:n,viewports:[]},a[n._id].viewports.push(c)))}return i=Object.values(p).map(({widget:n,viewports:c})=>$(n,c)),r=Object.values(a).map(({widget:n,viewports:c})=>$(n,c)),s=Object.values(l).map(({widget:n,viewports:c})=>$(n,c)),{background:t,regular:M(i),topFixed:M(r),backFixed:M(s)}}isViewportEnabled(e){let t=v(e);return t==="viewport_default"?!0:this.model[t]?.enabled}},{useStore:Gt,Provider:Ut}=g.createContext()});var L,Ve=f(()=>{"use strict";A();T();w();Le();J();L=class extends g{constructor(){super();o(this,"value","default");this.initStore(),this.setState({value:this.getProjectViewport()}),this.bindEvents()}bindEvents(){if(z())return;let e=oe(this.refreshProjectViewport,40);window.addEventListener("resize",e),window.addEventListener("orientationchange",e)}refreshProjectViewport(){this.setState({value:this.getProjectViewport()})}getProjectViewport(){if(z())return"default";let e=window.innerWidth,t=S.isPortrait();if(S.isIpad())return t?"tablet_portrait":"default";if(window.devicePixelRatio>1||S.isMobile()||S.isTouch()){if(t)return e<=599?"phone_portrait":e>=600&&e<=1024?"tablet_portrait":"default";if(e>980)return"default";let i=P.viewports.reduce((r,s,p)=>Math.abs(s.width-e)<=Math.abs(P.viewports[r].width-e)?p:r,0);return P.viewports[i].name}return"default"}}});var Ye,k,We=f(()=>{"use strict";G();w();D();Ye={viewertype:"vertical"},k=class extends g{constructor(e){super();o(this,"projectViewport");o(this,"_state");o(this,"state");this.initStore(),this.setState({projectViewport:e.project.projectViewport.value}),e.project.projectViewport.subscribe(t=>t.value,t=>{this.setState({projectViewport:t}),this.computeOptions()}),this._state={options:{...Ye,...e.project.model.opts||{}},viewport_phone_portrait:{options:e.project.model.viewport_phone_portrait?.opts||{}},viewport_tablet_portrait:{options:e.project.model.viewport_phone_portrait?.opts||{}}},this.setState({state:this._state.options}),this.computeOptions()}getOverrides(e){return e!=="viewport_default"?this._state[e]?.options:{}}computeOptions(){this.setState({state:this.getOptionsForViewport(this.projectViewport)})}setOptions(e){let t=v(this.projectViewport);if(t==="viewport_default"){let i={...this._state.options,...e};this._state.options=i}else{let r={...this.getOverrides(t),...e},s={...this._state.options,...r};this._state[t].options=s}this.computeOptions(),window.dispatchEvent(new Event("resize"))}getOptionsForViewport(e){let t=v(e),i=this.getOverrides(t);return{...this._state.options,...i}}}});function Ie(u){let d=null;function e(r){return d||(d=new be(u),de("scroll",d)),d?.addListener(r),()=>{d?.removeListener(r)}}function t(r,s=[]){(0,je.useEffect)(()=>{let p=e(r);return()=>{p()}},s)}function i(){d?.destroy()}return{useScrollPosition:t,destroyScroll:i,scrollSubscribe:e}}var je,Me=f(()=>{"use strict";je=F(U());Ze();Ce()});var gi,ui,Te,Re=f(()=>{"use strict";Me();({useScrollPosition:gi,destroyScroll:ui,scrollSubscribe:Te}=Ie())});var H,Ae=f(()=>{"use strict";Fe();H=class{constructor(d=4){o(this,"queue",new Map);o(this,"isProcessing",!1);o(this,"concurrency");o(this,"executingIds",new Set);this.concurrency=d}add(d,e){this.queue.set(d,e),this.isProcessing||this.process()}async process(){for(this.isProcessing=!0;this.queue.size>0;){let d=this.getBatch();await Promise.all(Array.from(d).map(([e,t])=>this.executeSafely(e,t))),await new Promise(e=>setTimeout(e,0))}this.isProcessing=!1}getBatch(){let d=new Map;for(let[e,t]of this.queue){if(d.size>=this.concurrency)break;this.executingIds.has(e)||(d.set(e,t),this.executingIds.add(e),this.queue.delete(e))}return d}async executeSafely(d,e){try{await e()}catch{console.error(new le("Cannot execute queued task",{taskId:d}))}finally{this.executingIds.delete(d)}}}});var Oe,$e,C,_e=f(()=>{"use strict";Oe=F(U());G();A();fe();Ue();Re();Ae();$e=new H(20),C=class extends V{constructor(e){super(e);o(this,"viewertype");o(this,"project");o(this,"currentPageId");o(this,"nextAdjacentPageId");o(this,"nextPageData",null);this.currentPageId=e.initialPageId,this.project=e.project,this.viewertype=this.project.options.state.viewertype,this.project.options.subscribe(t=>t.state.viewertype,t=>{this.viewertype=t}),this.setCurrentPage(e.initialPageId,!0),this.bindScrollListener()}setCurrentPage(e,t){$e.add(this.model._id,()=>{if(this._model.pid!==e){let i=!1;R(this._model,r=>{if(r){r.pid=e;let s=he(r,e,t?["hidden","z"]:["hidden"]);(t||s.hidden!==r.hidden)&&(Object.assign(r,s),i=!0)}}),i&&(0,Oe.startTransition)(()=>{this.computeWidgetModel()})}})}bindRouter(e){e.subscribe(t=>({currentPageId:t.state.currentPageId,nextAdjacentPageId:t.state.nextAdjacentPageId}),()=>{this.setCurrentPage(e.state.currentPageId,!1),this.currentPageId=e.state.currentPageId,this.nextAdjacentPageId=e.state.nextAdjacentPageId;let t=this.nextAdjacentPageId?this.project.findPageById(this.nextAdjacentPageId):void 0;t&&(this.nextPageData={pageScale:t.meta.state.scale,offsetTop:t.element.offset.top})},!0)}bindScrollListener(){this.viewertype==="vertical"&&Te(this.handleAboveWidgetsScroll)}handleAboveWidgetsScroll(e){if(!this.nextPageData){this.handleVisibility(!1,!1);return}let t=this.element?.rect?.height??0,i=this.element?.offset?.top??0,r=this.nextPageData.pageScale,s=t*r,p=i*r,a=this.nextPageData.offsetTop,l=e.scrollTop,m=a-l<p+s,h=a-l<p,n=!this.handleVisibility(m,h);if(n!==this.visibility.isVisible){let c={visibility:{...this.visibility,isVisible:n}};n&&!this.rendered&&(c.rendered=!0),this.setState(c)}}handleVisibility(e,t){return this.nextAdjacentPageId?(this.isAboveWidgetHidden(this.currentPageId)||e&&this.isAboveWidgetHidden(this.nextAdjacentPageId))&&!(t&&!this.isAboveWidgetHidden(this.nextAdjacentPageId)):this.isAboveWidgetHidden(this.currentPageId)}isAboveWidgetHidden(e){let t=this.model.hidden,i=this.model._hidden;if(i&&Array.isArray(i)){let r=i.find(s=>s.pid===e)||i.find(s=>s.pid==="default");if(r&&typeof r.value=="boolean")return r.value}return!!t}}});var B,De=f(()=>{"use strict";T();X();Q();K();Y();_e();w();B=class extends g{constructor(e){super();o(this,"project");o(this,"triggersStore");o(this,"animationsStore");o(this,"zIndexStore");o(this,"aboveWidgets");o(this,"abovePage");this.initStore(),this.project=e.project,this.setState({triggersStore:new x,animationsStore:new W,zIndexStore:new j}),this.setState({aboveWidgets:this.createAboveAllWidgets(e.aboveAllWidgets,e.initialPageId)}),this.animationsStore.init(this.aboveWidgets),this.setState({abovePage:new I({page:{_id:"above-page",num:-1,num_id:-1,height:0},project:this.project,animationsStore:this.animationsStore,triggersStore:this.triggersStore})}),this.zIndexStore.init(this.aboveWidgets)}createAboveAllWidgets(e=[],t){let i=[];for(let r of e)i.push(new C({widget:r,initialPageId:t,pageMeta:void 0,project:this.project,triggersStore:this.triggersStore,animationsStore:this.animationsStore,zIndexStore:this.zIndexStore}));return i}bindRouter(e){for(let t of this.aboveWidgets)t.bindRouter(e);e.subscribe(t=>t.state.currentPageId,this.syncCurrentPageViewport),this.syncCurrentPageViewport(this.project.meta.initialPageId)}syncCurrentPageViewport(e){let i=this.project.findPageById(e)?.meta.state;i&&i.availableViewports.length&&!se(this.abovePage.meta.state.availableViewports,i.availableViewports)&&this.abovePage.meta.setState(r=>({state:{...r.state,currentViewport:i.currentViewport,hasPhoneViewport:i.hasPhoneViewport,hasTabletViewport:i.hasTabletViewport,availableViewports:i.availableViewports}}))}}});var Ee,$i,Xi,Xe=f(()=>{"use strict";G();ce();w();X();Ve();We();De();ue();Ee=class extends g{constructor(e){super();o(this,"model");o(this,"pages",[]);o(this,"element",new O);o(this,"projectViewport");o(this,"options");o(this,"meta");o(this,"abovePage");this.initStore(),this.setState({model:e.project,projectViewport:new L}),this.setState({options:new k({project:this})});let t=e.initialPageId||this.findPageByIndex("first")?.model._id||"";this.setState({meta:{num_id:this.model.num_id,title:this.model.title||"",description:this.model.title||"",masterSharePageId:this.model.master_share_pid||"",editParams:this.model.edit_params||{},owner:this.model.user,forbiddenBackground:this.model.pass_bg,publicPath:e.publicPath,isExportedProject:e.isExportedProject||!1,isProjectOnDomain:e.isProjectOnDomain||!1,isProjectOnProfileDomain:e.isProjectOnProfileDomain||!1,exportedBasePath:e.exportedBasePath||"",initialPageId:t,templateSet:e.templateSet}}),this.setState({abovePage:new B({aboveAllWidgets:this.model.aboveAllWidgets,initialPageId:t,project:this})}),this.setState({pages:this.createPages(this.model.pages||[])}),this.bindElementListener()}bindElementListener(){this.element.subscribe(e=>e.rect,()=>{this.updatePageVirtualOffsets()})}updatePageVirtualOffsets(){if(this.options.state.viewertype!=="vertical")return;let e=0;for(let t of this.pages)t.setState({virtualOffset:e}),e+=t.element.offset.height}createPages(e){let t=[];for(let i of e)t.push(new I({project:this,page:y(i)}));return this.updatePageVirtualOffsets(),t}findPageByIndex(e){let t=typeof e=="number"?e:e==="first"?0:this.pages.length-1,i=this.pages[t];if(i)return i}findPageById(e){return this.pages.find(t=>t.model._id===e)}findPageByUri(e){return this.pages.find(t=>t.model.uri===e)}findPageByNum(e){return this.pages.find(t=>t.model.num===e)}getPageIndex(e){let t=this.pages.findIndex(i=>i.model._id===e);return t===-1?null:t}getPageUri(e){let t=this.findPageById(e);return t?t.model.uri?`${t.model.uri}/`:t.model.num===1?"":`${t.model.num}/`:null}getPageNum(e){let t=this.findPageById(e);return t?t.model.num:null}getFirstPage(){return this.pages[0]}getLastPage(){return this.pages[this.pages.length-1]}},{useStore:$i,Provider:Xi}=g.createContext()});export{Gt as a,Ut as b,X as c,gi as d,Te as e,Re as f,Ee as g,$i as h,Xi as i,Xe as j};
